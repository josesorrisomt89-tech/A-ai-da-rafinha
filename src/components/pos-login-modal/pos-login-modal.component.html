<div class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4" (click)="closeModal()">
  <div class="bg-[var(--bg-card)] rounded-2xl shadow-2xl w-full max-w-sm" (click)="$event.stopPropagation()">
    @switch (step()) {
      @case ('pin') {
        <form (ngSubmit)="checkPin()">
          <div class="p-6 text-center">
            <h2 class="text-2xl font-bold text-[var(--text-primary)]">Acesso Restrito</h2>
            <p class="text-[var(--text-secondary)] mt-2">Digite o PIN para continuar</p>
          </div>

          <div class="px-6 py-8">
            <label for="pin-input" class="sr-only">PIN</label>
            <input 
              id="pin-input"
              type="password"
              name="pin"
              [ngModel]="pin()" 
              (ngModelChange)="pin.set($event)"
              (input)="onInput()"
              maxlength="4"
              autocomplete="off"
              autofocus
              class="w-full text-center text-4xl tracking-[.5em] font-mono bg-[var(--bg-page)] text-[var(--text-primary)] border-2 rounded-lg p-4 focus:border-[var(--color-primary)] focus:ring-[var(--color-primary)] transition"
              [class.border-red-500]="error()"
              [class.border-[var(--border-color)]]="!error()"
              placeholder="••••"
            >
            @if (error()) {
              <p class="text-red-500 text-center text-sm mt-2">{{ error() }}</p>
            }
          </div>

          <div class="p-6 bg-[var(--bg-page)] rounded-b-2xl">
            <button type="submit" class="w-full bg-[var(--color-primary)] text-[var(--color-text-on-primary)] font-bold py-3 px-8 rounded-lg shadow-md hover:bg-[var(--color-primary-hover)] transition-all duration-300 transform hover:scale-105 disabled:bg-slate-400 disabled:cursor-not-allowed">
              Entrar
            </button>
          </div>
        </form>
      }
      @case ('destination') {
        <div class="p-8 text-center">
          <div class="flex justify-center items-center h-16 w-16 bg-green-100 rounded-full mx-auto mb-4">
            <svg class="h-10 w-10 text-green-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
          </div>
          <h2 class="text-2xl font-bold text-[var(--text-primary)]">Login bem-sucedido!</h2>
          <p class="text-[var(--text-secondary)] mt-2 mb-6">Para qual módulo você deseja ir?</p>
          
          <div class="space-y-3">
            @if(canAccessPos()) {
              <button (click)="selectDestination('pos')" class="w-full bg-slate-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-slate-700 transition-colors">
                Acessar PDV Local
              </button>
            }
            @if(canAccessKitchen()) {
              <button (click)="selectDestination('kitchen')" class="w-full bg-amber-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-amber-700 transition-colors">
                Acessar Cozinha
              </button>
            }
            @if(canAccessAdmin()) {
              <button (click)="selectDestination('admin')" class="w-full bg-slate-800 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-slate-900">
                Acessar Painel Admin
              </button>
            }
          </div>
        </div>
      }
    }
  </div>
</div>