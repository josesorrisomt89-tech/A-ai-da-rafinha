<div class="relative min-h-full bg-[var(--bg-page)] pb-24">
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold text-[var(--text-primary)] mb-2">Acompanhe seu Pedido</h1>
    <p class="text-[var(--text-secondary)] mb-6">Digite o código do seu pedido para ver o status em tempo real.</p>

    <form (submit)="searchOrder(); $event.preventDefault()" class="flex items-center gap-2 mb-8">
      <input type="text" 
             name="orderId"
             [ngModel]="orderIdInput()"
             (ngModelChange)="orderIdInput.set($event)"
             placeholder="Digite o código aqui..."
             class="flex-grow w-full p-3 border border-[var(--border-color)] rounded-lg shadow-sm focus:ring-2 focus:ring-[var(--color-primary)] focus:border-[var(--color-primary)] transition bg-[var(--bg-card)] text-[var(--text-primary)]">
      <button type="submit" class="bg-[var(--color-primary)] text-[var(--color-text-on-primary)] font-bold py-3 px-6 rounded-lg shadow-md hover:bg-[var(--color-primary-hover)] transition-colors">
        Buscar
      </button>
    </form>

    @if(foundOrder(); as order) {
      @if (order !== 'not_found') {
        <div class="bg-[var(--bg-card)] p-6 rounded-lg shadow-lg">
          <div class="flex justify-between items-start mb-6">
            <div>
              <h2 class="text-xl font-bold text-[var(--text-primary)]">Pedido #{{ order.id.substring(0,8) }}</h2>
              <p class="text-[var(--text-secondary)]">Cliente: {{ order.customerName }}</p>
            </div>
            <a [href]="getWhatsappShareLink(order)" target="_blank" class="flex items-center gap-2 text-sm bg-green-100 text-green-800 font-semibold py-2 px-3 rounded-lg hover:bg-green-200 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
              Compartilhar
            </a>
          </div>

          @if(order.status === 'cancelled') {
            <div class="p-4 bg-red-100 text-red-700 rounded-lg text-center">
              <h3 class="font-bold text-lg">Pedido Cancelado</h3>
              <p>Este pedido foi cancelado pela loja.</p>
            </div>
          } @else if (order.status === 'pending') {
             <div class="p-4 bg-yellow-100 text-yellow-700 rounded-lg text-center">
              <h3 class="font-bold text-lg">Aguardando Confirmação</h3>
              <p>A loja ainda não confirmou o seu pedido.</p>
            </div>
          } @else {
            <!-- Progress Tracker -->
            <div class="space-y-4">
              @for (step of statusSteps; track step.key; let i = $index) {
                @let currentIndex = getStatusIndex(order.status);
                <div class="flex items-center gap-4">
                  <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center"
                       [class.bg-green-500]="i <= currentIndex"
                       [class.bg-slate-300]="i > currentIndex">
                    @if(i <= currentIndex) {
                      <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    }
                  </div>
                  <div class="flex-grow">
                    <p class="font-semibold"
                       [class.text-[var(--text-primary)]]="i <= currentIndex"
                       [class.text-slate-400]="i > currentIndex">
                      {{ step.text }}
                    </p>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      } @else {
        <div class="bg-[var(--bg-card)] p-8 rounded-lg shadow-lg text-center">
          <h2 class="text-xl font-bold text-red-600">Pedido não encontrado</h2>
          <p class="text-[var(--text-secondary)] mt-2">Verifique o código e tente novamente.</p>
        </div>
      }
    } @else if(searchedId()) {
       <div class="bg-[var(--bg-card)] p-8 rounded-lg shadow-lg text-center">
          <p class="text-[var(--text-secondary)]">Buscando...</p>
        </div>
    }

    <!-- Order History -->
    <div class="mt-12">
      <h2 class="text-xl font-bold text-[var(--text-primary)] mb-4">Histórico de Pedidos Anteriores</h2>
      @if(orderHistory().length > 0) {
        <div class="space-y-4">
          @for(order of orderHistory(); track order.id) {
            <div class="bg-[var(--bg-card)] p-4 rounded-lg shadow-md flex justify-between items-center">
              <div>
                <p class="font-semibold text-[var(--text-primary)]">Pedido de {{ order.timestamp | date:'dd/MM/yy' }}</p>
                <p class="text-sm text-[var(--text-secondary)]">{{ order.items.length }} item(ns) - R$ {{ order.total.toFixed(2) }}</p>
              </div>
              <button (click)="reorder(order)" class="bg-green-100 text-green-800 font-semibold py-2 px-4 rounded-lg hover:bg-green-200 transition-colors text-sm">
                Pedir Novamente
              </button>
            </div>
          }
        </div>
      } @else {
        <div class="bg-[var(--bg-card)] p-8 rounded-lg shadow-lg text-center">
          <p class="text-[var(--text-secondary)]">Você ainda não tem pedidos no seu histórico.</p>
        </div>
      }
    </div>
  </div>
</div>

<!-- Bottom Navigation -->
<div class="fixed bottom-0 left-0 right-0 h-20 bg-[var(--bg-card)] border-t border-[var(--border-color)] shadow-lg z-20 flex items-center justify-around">
    <button (click)="changeView('menu')" class="flex flex-col items-center justify-center text-[var(--text-secondary)] hover:text-[var(--color-primary)]">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/></svg>
        <span class="text-xs mt-1">Cardápio</span>
    </button>
     <button class="flex flex-col items-center justify-center text-[var(--color-primary)] font-semibold">
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" x2="23" y1="1" y2="23"/></svg>
        <span class="text-xs mt-1">Acompanhar</span>
    </button>
    <button (click)="changeView('pos')" class="flex flex-col items-center justify-center text-[var(--text-secondary)] hover:text-[var(--color-primary)]">
       <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10,17 15,12 10,7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>
        <span class="text-xs mt-1">Entrar</span>
    </button>
</div>